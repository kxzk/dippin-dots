#!/usr/bin/env bash
set -e

GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m'

# Check if argument is provided
if [ $# -eq 0 ]; then
    echo "Usage: ama-issue <issue title>"
    exit 1
fi

# Use all arguments as the title
TITLE="$*"

# Team and Project IDs
TEAM_ID="${LINEAR_DATA_SCIENCE_TEAM}"
PROJECT_ID="${LINEAR_AMADEUS_REFACTOR_PROJECT}"

# Create the issue with linearite
RESPONSE=$(linearite create "$TITLE" \
  --team-id "$TEAM_ID" \
  --project-id "$PROJECT_ID" 2>&1)

# Extract branch name from response
BRANCH_NAME=$(echo "$RESPONSE" | grep -oE 'branch name: .+' | cut -d':' -f2 | xargs)

# Check if we got a branch name
if [ -z "$BRANCH_NAME" ]; then
    echo -e "${RED}Failed to extract branch name${NC}"
    exit 1
fi

# Print just the branch name in green
echo -e "${GREEN}${BRANCH_NAME}${NC}"
